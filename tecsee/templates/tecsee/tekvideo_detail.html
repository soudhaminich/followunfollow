{% extends "tecsee/base_tekvideo.html" %}
{% load humanize %}
{% block title %}
Teckiy - Learn,Share & Earn
{% endblock %}
{% load support_extras %}
{% load markdown_deux_tags %}
{% load static %}
{% block content %}

<div class="row grid2 mt-5">
    <div class="col-lg-2 d-lg-block d-none pl-2 pr-1">
        {% include "blogs/leftnav.html" %}
    </div>
    <div class="col-lg-7 col-12 pl-2 pb-0 pr-5">
        <div class="d-lg-flex" style="height:100%;">
            
            <!-- signed out alert message -->
            <div class="pt-4 pl-4 w-100">
                {% if messages %}
                {% for message in messages %}
                <div style="border-radius: 25px;"
                    class="text-center prior-font font-weight-bold alert alert-{{ message.tags }} alert-dismissible"
                    role="alert">
                    {{ message }}
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                {% endfor %}
                {% endif %}
                <!-- signed out alert message -->
                <!-- all-tkts-scrollable sctn -->
                <div class="pl-1 pr-1 pt-0 mt-3 mx-auto">
                    <p class="mt-2 mb-4 prior-font text-dark fs_vary mr-auto">{{ object.title }}
                    </p>
                    <video class="border rounded card-img-top" poster="{{ object.image }}" controls controlsList="nodownload">
                        <source src="{{ object.video }}" type="">
                    </video>
                    <div class="mt-3 text-muted">
                        {% for tag in object.tags.all %}
                        #{{ tag.name }}
                        {% endfor %}
                    </div>

                    <div class="fs_med2 mt-2 wordwrap">
                        <div class="d-flex flex-wrap ">
                            <div class="my-auto mr-1 fs_med text-muted wordwrap prior-font">Views</div>
                            {% if object.objectviewed_set.count > 0 %}
                            <div style="vertical-align:baseline"class="pt-1 my-auto text-muted mr-4 wordwrap font-weight-bold">{{ object.objectviewed_set.count }}</div>
                            {% else %}
                            <div class="my-auto text-muted mr-4 wordwrap font-weight-bold">1</div>
                            {% endif %}
                            <div class="my-auto ml-auto mr-1 text-muted wordwrap prior-font">Posted</div>
                            <div class="my-auto text-muted wordwrap font-weight-bold">{{ object.created_date|naturaltime }}</div>
                        </div>
                    </div>
                    <hr class="mb-0">
                    <div class="wordwrap pt-3">
                        <img width="60" height="60" class="mr-1 rounded-circle"
                            src="{{ object.user.profile.image.url }}" alt="">
                        <a style="font-size:medium" class="my-auto text-muted wordwrap text-decoration-none"
                            href="">{% display_name object.user %}</a>
                    </div>
                    <div class="fs_teen mt-4">
                        <span class="fs_med prior-font font-weight-bold text-muted">Description:</span>
                        <span>{{ object.description|safe }}</span>
                    </div>
                    <hr>
                    {% if comment_obj %}
                    <div>
                        <span style="font-size:large" class="font-weight-bold prior-font mr-1">{{ comment_obj.count }}</span>
                        <span style="font-size:large" class="prior-font text-muted">Comments</span>
                    </div>
                    {% else %}
                    <span style="font-size:large" class="font-weight-bold prior-font mr-1">No Comments</span>
                    {% endif %}
                    <form class="mb-5 mt-3" id="comment-form" method='POST' action="{% url 'comments:comment_tecsee_view' object.id %}">
                        {% csrf_token %}
                        <div class="marked-content-show">
                        </div>
                        <textarea class='form-control mb-2' rows='6' cols='50' placeholder='Write your comment/question'
                            name='comment' required></textarea>
                        <button type="submit" id="commentmsgtest"
                            class="btn btn-primary prior-font mt-1 p-0 pl-1 pr-1 float-right">Submit</button>
                    </form>
                    <!-- comments heading -->
                    {% if comment_obj %}
                    <!-- comments section -->
                    {% for msg in comment_obj %}
                    <div class="media">
                        <div class="media-body mt-4">
                            <div>
                                <div class="d-flex flex-wrap">
                                    <div class="mr-2 tekvid-comment-profile-img">
                                        <a href=""><img width="50" height="50"
                                                src="{{ msg.user.profile.image.url }}" alt=""></a>
                                    </div>
                                    <span class="tekvid-comment-uname">
                                        <a class="text-decoration-none fs_teen text-dark prior-font" href="">{% display_name msg.user %}</a>
                                        <div class="fs_teen text-muted">Posted  {{ msg.timestamp|naturaltime }}</div>
                                    </span>
                                </div>
                                <div class="fs_teen mt-1">
                                    {{ msg.comment|safe }}
                                </div>
                                {% if request.user.username == msg.user.username %}
                                <small class="prior-font mt-1">
                                    <a class="text-decoration-none" href="{% url 'comments:comment_delete' msg.id 'video' %}">Delete</a>
                                </small>
                                {% endif %}
                            </div>
                            <hr class="mb-1 mt-1">
                            <!-- subcomment section -->
                            {% for child_comment in msg.children  %}
                            <div class="mb-1 ml-3 fs">
                                <span class="">{{ child_comment.comment|safe  }}</span>
                                <a class="text-decoration-none" href="">{% display_name child_comment.user %}</a>
                                <span class="text-muted">Posted {{ child_comment.timestamp|naturaltime }}</span>
                                {% if request.user.username == child_comment.user.username %}
                                <span class="text-muted">
                                    <a href="{% url 'comments:reply_delete' child_comment.id 'video' %}" class="text-decoration-none">Delete</a>
                                </span>
                                {% endif %}
                            </div>
                            {% endfor %}

                            <!-- Newly added -->
                            <a onclick="addComment( '{{msg.id}}');return false;" class="ml-3 text-decoration-none fs_teen"
                                href="">add a comment</a>
                            <div id="reply_form_{{msg.id}}" class="ml-3 tek-vid-add-cmt-box mt-2">
                                <form method='POST' class="" action="{% url 'comments:comment_tecsee_view' msg.object_id %}">
                                    {% csrf_token %}
                                    <div class="marked-content-show">
                                        {% comment %} <input type="hidden" onkeypress="codeBlock()"> {% endcomment %}
                                    </div>
                                    <div class="form-group mb-1">
                                        <textarea class="form-control" id="exampleFormControlTextarea1" name='comment'
                                            placeholder='write your reply' rows="5"></textarea>
                                    </div>
                                    <input type="hidden" name="parent_id" value="{{ msg.id }}">
                                    <div class="">
                                        <button type="submit" id="another-btn"
                                            class="btn btn-primary prior-font pl-1 pr-1 p-0 fs_teen">Add a
                                            Comment</button>
                                    </div>
                                </form>
                            </div>
                            <hr class="mt-1 mb-1 ml-3">
                            <!-- media body -->
                        </div>
                        <!-- media div -->
                    </div>
                    {% endfor %}
                    {% endif %}
                    <!-- end of comments section -->
                </div>
            </div>
        </div>
        <br>
    </div>
    <!-- end of center section -->

    <!-- video list column -- right most section -->
    <div class="col-lg-4 p-4 pt-4 pb-0 right-fixed-cards-sctn">
        <!-- looping starts here -->
        {% for video in video_list %}
        <div class="row pt-2">
            <div class="col-7 video-detail-list p-0 pl-3">
                <a class="text-decoration-none" href="{{ video.get_absolute_url  }}">
                    <img class="border rounded"style="width:100%; height:90%;" src="{{ video.image }}" alt="">
                    <img class="play-btn-img border bg-white rounded-circle"
                        src="{% static 'blogs/images/play-btn-img.svg' %}" alt="">
                    <span class="duration-slot-detail fs_teen prior-font font-weight-bold text-muted">{{ video.duration }}</span>
                </a>
            </div>
            <div class="col-5 p-0 pl-3 pr-1">
                <div class="video-detail-col-lineht">
                    <a href="{{ video.get_absolute_url }}" class="wordwrap text-dark fs_teen font-weight-bold text-decoration-none prior-font">{{ video.title|truncatewords_html:15 }}
                    </a>
                </div>
                <div class="mt-1 wordwrap">
                    <img width="25" height="25" class="mr-1 rounded-circle"
                        src="{{ video.user.profile.image.url }}" alt="">
                    <a class="my-auto text-muted fs_teen wordwrap text-decoration-none" href="">{% display_name video.user %}</a>
                </div>
                <div class="mt-1 wordwrap">
                    <div class="d-flex flex-wrap my-auto">
                        <div class="my-auto mr-1 text-muted fs wordwrap">Views</div>
                        <div class="my-auto text-muted mr-2 fs wordwrap ">
                            {% if video.objectviewed_set.count > 0 %}
                            {{ video.objectviewed_set.count }}
                            {% else %}
                                1
                            {% endif %}
                        </div>
                        <div class="my-auto font-weight-bold text-muted fs_teen mr-2">||</div>
                        <div class="my-auto text-muted fs wordwrap">{{ video.created_date|date:"M d, y"}}</div>
                    </div>
                </div>
            </div>
        </div>
        <hr class="mt-1 mb-2">
        {% endfor %}
        <!-- looping ends here -->
    </div>
</div>

{% endblock %}
{% block extrajs %}
{% csrf_token %}
<script type="text/javascript">
    $(document).ready(function () {
        $("i").on("click", function () {
            console.log("Testing....");
            var this_ = $(this);
            console.log(this_);
            var favoriteUrl = this_.attr("href");
            console.log(favoriteUrl);

            $.ajax({
                url: favoriteUrl,
                method: "GET",
                success: function (data) {
                    console.log(data);
                    $.each(data, function () {
                        $(this_).attr("href", String(data.url));
                        $(this_).attr(
                            "style",
                            "font-size:24px;float: right;color:" + String(data.color)
                        );
                    });
                },
                error: function (data) {
                    console.log(data);
                    console.log(error);
                },
            });
        });
    });
</script>
<script>
    function addComment(msg_id) {
        let textBoxDisplay = document.getElementById("reply_form_"+ msg_id);
        textBoxDisplay.style.display = "block";
    }
</script>
{% endblock extrajs %}