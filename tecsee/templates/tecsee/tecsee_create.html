<html>
<head>
    <meta charset="utf-8">
    <title>s3direct</title>
    {{ form.media }}
    <style>
        p{
            clear: both;
        }
        label{
            margin-top: 50px;
        }
        .hide,.file-url,label[for="id_videos"],label[for="id_images"],.file-input{
            display: none !important;
        }
    </style>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
</head>
<body>
   
    <form class="" action="/" method="post">{% csrf_token %}
        {{ form.as_p }}
        <div style="margin:10px">
            <label for="image_upload">Image :</label>
            <input type="file" id="image_upload" accept='image/*'>
        </div>
        <div style="margin:10px">
            <label for="video_upload">Video :</label>
            <input type="file" id="video_upload"  accept='video/*'>
        </div>
    </form>
    
    <button onclick="check_upload()">Submit</button>
    <form id="final_sub" name="final_sub" method="post" action="{% url 'tecsee:store_url' %}">
        {% csrf_token %}
        <input type="hidden" id="image_url" value="" name="img_url">
        <input type="hidden" id="video_url" value="" name="vid_url">
    </form>
    <script>
        document.getElementsByClassName('file-input')[0].id = "img_s3_upload";
        document.getElementsByClassName('file-input')[1].id = "vid_s3_upload";

        //trigger starmap change event
        function trigger_change_event(element_id) {
            element = document.getElementById(element_id);
            var event = new Event('change');
            // Dispatch it.
            element.dispatchEvent(event);
        }

        function check_upload() {
            var title = document.getElementById('id_title').value
            var vid_upload = $("#video_upload").val();
            var img_upload = $("#image_upload").val();
            console.log(title)
            if (vid_upload == "" || img_upload == "" || title == "") {
                //TODO in future
                alert('Should not be null')
            } else {
                var file1 = document.querySelector('#image_upload');
                var file2 = document.querySelector('#img_s3_upload');
                file2.files = file1.files;

                var file_vid1 = document.querySelector('#video_upload');
                var file_vid2 = document.querySelector('#vid_s3_upload');
                file_vid2.files = file_vid1.files;

                trigger_change_event("vid_s3_upload");

                var myVar = setInterval(myTimer, 2500);

                function myTimer() {
                    check_video_url = document.getElementsByClassName('file-url')[1].value;
                    check_img_url = document.getElementsByClassName('file-url')[0].value;
                    if (check_video_url != '') {
                        trigger_change_event("img_s3_upload");
                        if (check_img_url != '') {
                            clearInterval(myVar);
                            $("#image_url").val(check_img_url);
                            $("#video_url").val(check_video_url);
                            $("#final_sub").submit();
                        }
                    }
                }
            }
        }
    </script>

</body>
</html>